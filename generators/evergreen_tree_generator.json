{
  "metadata": {
    "name": "Evergreen Tree Prompt Generator",
    "version": "0.1.0",
    "description": "Generates descriptive prompts for various evergreen trees in different settings and seasons, including small clusters.",
    "author": "Jules",
    "category": "creative",
    "tags": ["nature", "trees", "prompts", "creative writing", "art", "evergreen", "conifer", "clusters"]
  },
  "variables": {
    "current_season": {"type": "string", "default": "winter", "description": "Tracks the current season for conditional logic."},
    "tree_age_category": {"type": "string", "default": "mature", "description": "Tracks the general age/size category of the tree."},
    "tree_species_name": {"type": "string", "default": "pine", "description": "Stores the chosen primary species name. Ideally set by pick_species."},
    "setting_type": {"type": "string", "default": "forest", "description": "Stores the type of setting chosen."},
    "is_cluster": {"type": "boolean", "default": false, "description": "True if generating a cluster of trees."},
    "cluster_size": {"type": "number", "default": 1, "description": "Number of trees in the cluster (2-4 if is_cluster is true)."},
    "cluster_type": {"type": "string", "default": "single_species", "description": "Type of cluster: 'single_species' or 'mixed_species_simple'."},
    "secondary_species_name": {"type": "string", "default": "", "description": "Placeholder for secondary species text in mixed clusters."}
  },
  "grammar": {
    "pick_species": {
      "$include": "evergreen_tree_includes/species.json",
      "actions": [
        {"set_variable_from_selected_text": "tree_species_name"}
      ]
    },
    "pick_season": {"$include": "evergreen_tree_includes/seasons.json"},
    "pick_age_size": {"$include": "evergreen_tree_includes/age_sizes.json"},
    "pick_setting": {"$include": "evergreen_tree_includes/settings.json"},

    "pick_leaf_attribute": {"$include": "evergreen_tree_includes/leaf_attributes.json"},
    "pick_bark_attribute": {"$include": "evergreen_tree_includes/bark_attributes.json"},
    "pick_overall_shape": {"$include": "evergreen_tree_includes/overall_shapes.json"},
    "pick_cluster_descriptor": {"$include": "evergreen_tree_includes/cluster_descriptors.json"},
    "pick_ancient_mystic_feature": {"$include": "evergreen_tree_includes/ancient_mystic_features.json"},

    "pick_spring_detail": {"$include": "evergreen_tree_includes/spring_details.json"},
    "pick_summer_detail": {"$include": "evergreen_tree_includes/summer_details.json"},
    "pick_winter_detail": {"$include": "evergreen_tree_includes/winter_details.json"},

    "generate_leaf_description": [
      "its #pick_leaf_attribute#",
      "characteristic #pick_leaf_attribute#",
      "foliage described as #pick_leaf_attribute#"
    ],

    "seasonal_details_logic": {
      "type": "conditional",
      "options": [
        {"text": "#pick_spring_detail#", "conditions": {"current_season": {"$eq": "spring"}}},
        {"text": "#pick_summer_detail#", "conditions": {"current_season": {"$eq": "summer"}}},
        {"text": "#pick_winter_detail#", "conditions": {"current_season": {"$eq": "winter"}}},
        {"text": "its year-round foliage providing a touch of green", "conditions": {"current_season": {"$eq": "autumn"}}}
      ],
      "fallback": "displaying its steadfast greenery"
    },

    "optional_ancient_feature_logic": {
      "type": "conditional",
      "options": [{
        "text": ". #pick_ancient_mystic_feature#",
        "conditions": {
          "$and": [
            {"tree_age_category": {"$eq": "ancient"}},
            {"setting_type": {"$in": ["mountain_slope", "ancient_grove", "sacred_site"]}}
          ]}
      }],
      "fallback": ""
    },

    "determine_cluster_or_single": [
      {"text": "#generate_single_tree_description#", "weight": 75, "actions": {"set": {"is_cluster": false, "cluster_size": 1}}},
      {"text": "#generate_cluster_description#", "weight": 25, "actions": [{"set": {"is_cluster": true}}, {"rule": "#_set_cluster_details#"}]}
    ],

    "_set_cluster_details": [
      {"text": "", "weight": 28, "actions": {"set": {"cluster_type": "single_species", "cluster_size": 2}}},
      {"text": "", "weight": 28, "actions": {"set": {"cluster_type": "single_species", "cluster_size": 3}}},
      {"text": "", "weight": 14, "actions": {"set": {"cluster_type": "single_species", "cluster_size": 4}}},
      {"text": "", "weight": 18, "actions": {"set": {"cluster_type": "mixed_species_simple", "cluster_size": 2}}},
      {"text": "", "weight": 12, "actions": {"set": {"cluster_type": "mixed_species_simple", "cluster_size": 3}}}
    ],

    "generate_single_tree_description": [
      {"rule_once": "#pick_species#"},
      "A #tree_species_name.a_an# tree, noted as #pick_age_size# with #pick_overall_shape#, stands in #pick_season# #pick_setting#. The tree exhibits #generate_leaf_description# and #pick_bark_attribute#. It shows signs of the season with #seasonal_details_logic##optional_ancient_feature_logic#."
    ],

    "cluster_size_numeric_text": {
      "type": "conditional",
      "options": [
        {"text": "two", "conditions": {"cluster_size": {"$eq": 2}}},
        {"text": "three", "conditions": {"cluster_size": {"$eq": 3}}},
        {"text": "four", "conditions": {"cluster_size": {"$eq": 4}}}
      ],
      "fallback": "several"
    },

    "pick_different_species_text": {
        "$include": "evergreen_tree_includes/species.json"
    },

    "generate_cluster_description": {
      "type": "conditional",
      "options": [
        {
          "actions": [{"rule_once":"#pick_species#"}],
          "text": "#pick_cluster_descriptor# #cluster_size_numeric_text# #tree_species_name.plural# grow together. They are generally #pick_age_size#, sharing a common #pick_overall_shape#, and located #pick_setting#. As #pick_season# progresses, they jointly display #generate_leaf_description# and similar #pick_bark_attribute#. They reflect the season with #seasonal_details_logic##optional_ancient_feature_logic#.",
          "conditions": {"cluster_type": {"$eq": "single_species"}}
        },
        {
          "text": "#generate_single_tree_description# Nearby, #pick_different_species_text.a_an# other evergreen, of a different kind, contributes to the small stand. It is a #pick_age_size# specimen.",
          "conditions": {"cluster_type": {"$eq": "mixed_species_simple"}}
        }
      ],
      "fallback": "A group of evergreen trees is present."
    },

    "debug_vars": [
      "Cluster: #is_cluster#, Size: #cluster_size#, Type: #cluster_type#. Season: #current_season#, Age Category: #tree_age_category#, Species: #tree_species_name#, Setting: #setting_type#, Secondary Species: #secondary_species_name#"
    ]
  },
  "entry_points": {
    "default": "#determine_cluster_or_single#",
    "debug": "#debug_vars#"
  }
}
